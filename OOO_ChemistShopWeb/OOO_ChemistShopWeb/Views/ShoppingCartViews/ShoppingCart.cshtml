@using OOO_ChemistShopWeb.Models;

@{
    ViewBag.Title = "Корзина";
}

<strong style="font-family: 'Times New Roman', Times, serif; font-size: 18pt">Корзина</strong>
<hr />
@{
    if (Session["Cart"] != null)
    {
        using (Html.BeginForm("UpdateOrder", "ShoppingCartViews", FormMethod.Post))
        {
            @Html.AntiForgeryToken()


            <table style="display: flex; justify-content: center; font-size: 16pt; font-family: 'Times New Roman', Times, serif" class="shopping-cart">
                <tr style="text-align: center">
                    <th width="150px">Изображение</th>
                    <th width="150px">Название</th>
                    <th width="180px">Производитель</th>
                    <th width="130px">Цена</th>
                    <th width="100px">Скидка<br />(в %)</th>
                    <th width="115px">Скидка<br />(в руб.)</th>
                    <th width="125px">Цена по<br />скидке</th>
                    <th width="130px">Количество</th>
                    <th colspan="2" width="150px">Общая цена <br />товара</th>
                </tr>

                @foreach (var cart in (List<OOO_ChemistShopWeb.Classes.ProductsInOrder>)Session["Cart"])
                {
                    <tr style="text-align: center">
                        <td>

                            @if (!String.IsNullOrEmpty(cart.Medicine.MedicinePhoto))
                            {
                                <img src="/Images/@cart.Medicine.MedicinePhoto" class="card-img-top rounded"
                                     style="width: auto; height: 80px; max-width: 100%; margin-top: 5px" />
                            }
                            else
                            {
                                <img src="/Images/Pictures.png" class="card-img-top rounded"
                                     style="width: auto; height: 80px; max-width: 100%; margin-top: 5px" />
                            }
                        </td>
                        <td>@cart.Medicine.MedicineName</td>
                        <td>@cart.Medicine.Manufacturers.ManufacturerName</td>
                        <td>@(String.Format("{0:f2}", cart.Medicine.MedicineCost)) ₽</td>
                        <td>@(String.Format("{0:f2}", cart.Medicine.MedicineDiscount))</td>
                        <td>@(String.Format("{0:f2}", cart.Medicine.MedicineCost * cart.Medicine.MedicineDiscount / 100)) ₽</td>
                        <td>@(String.Format("{0:f2}", cart.Medicine.MedicineCost - (cart.Medicine.MedicineCost * cart.Medicine.MedicineDiscount / 100))) ₽</td>

                        <td>
                            <input type="number" name="quantity" id="quantity" min="1" max="99" value="@cart.MedicineCountOrder" /><br />
                        </td>
                        <td width="100px">@(String.Format("{0:f2}", cart.Medicine.MedicineCost * cart.MedicineCountOrder)) ₽</td>

                        <td width="115px">
                            @Html.ActionLink("Удалить", "Delete", "ShoppingCartViews", new { id = cart.Medicine.MedicineId },
                           new
                                {
                                    onclick = "return confirm ('Вы точно хотите удалить " + cart.Medicine.MedicineName + " из корзины?');",
                               @class = "delete-shopping",
                                    style = "text-decoration: none; "
                                })
                        </td>
                    </tr>
                }

                <tr>
                    <td colspan="9" class="total-price-text">Сумма заказа без скидки:</td>
                    <td style="text-align: center" class="total-price-digit">
                        @{
                            List<OOO_ChemistShopWeb.Classes.ProductsInOrder> temp = (List<OOO_ChemistShopWeb.Classes.ProductsInOrder>)Session["Cart"];
                            var totalSum = String.Format("{0:f2}", temp.Sum(x => x.MedicineCountOrder * x.Medicine.MedicineCost));

                        }

                        @totalSum ₽
                    </td>
                </tr>

                <tr>
                    <td colspan="9" class="total-price-text">Сумма заказа со скидкой:</td>
                    <td style="text-align: center" class="total-price-digit">
                        @{
                            List<OOO_ChemistShopWeb.Classes.ProductsInOrder> temp2 = (List<OOO_ChemistShopWeb.Classes.ProductsInOrder>)Session["Cart"];
                            var totalDiscount = String.Format("{0:f2}",temp2.Sum(x => x.Medicine.MedicineCost * x.MedicineCountOrder - (x.Medicine.MedicineCost * x.Medicine.MedicineDiscount * x.MedicineCountOrder / 100)));
                        }

                        @totalDiscount ₽
                    </td>
                </tr>
                <tr>
                    <td colspan="9" class="total-price-text">Сумма скидки заказа:</td>
                    <td style="text-align: center" class="total-price-digit">
                        @{
                            List<OOO_ChemistShopWeb.Classes.ProductsInOrder> temp3 = (List<OOO_ChemistShopWeb.Classes.ProductsInOrder>)Session["Cart"];
                            var Discount = String.Format("{0:f2}", temp3.Sum(x => x.Medicine.MedicineCost * x.Medicine.MedicineDiscount * x.MedicineCountOrder / 100));
                        }

                        @Discount ₽
                    </td>
                </tr>
            </table>

            <br />
            <div style="display: grid; justify-content: center; text-align: center; width: 1300px;">
                <div style="display: flex; justify-content: center; text-align: center; margin-bottom: 25px">
                    <input type="submit" value="Обновить корзину" class="update-shopping" />
                    <a href="@Url.Action("RemoveAllShoppingCart", "ShoppingCartViews")" onclick="return confirm ('Вы точно хотите удалить все товары из корзины?')" >
                        <input type="button" value="Удалить все товары из корзины"  style="height: 50px; padding: 5px" class="deleteAll-shopping" />
                    </a>
                </div>

                @Html.ActionLink("Перейти к оформлению заказа", "CheckOut", "ShoppingCartViews", null, new { @class = "checkout-shopping", style="margin-bottom: 10px; color: white;"  })

                @Html.ActionLink("Продолжить покупки", "ProductsView", "Home", null, new { @class = "continue-shopping" })
            </div>
            <br />

            <div style="display: flex; justify-content: center; font-size: 16pt" class="text text-danger">
                @Html.Raw(@Session["Message"])
            </div> 

        }

    }
    else
    {
        <h2 style="margin: auto">К сожалению, в корзине отсуствуют товары :(</h2>
    }
}

<style>

    .shopping-cart table, th, td {
        border: 1px solid black;
    }

    .shopping-cart #quantity {
        width: 90%;
        border: 1px solid #808080;
        border-radius: 2px;
        text-align: center;
    }

    .shopping-cart .delete-shopping {
        color: black;
        border: 1px solid black;
        background-color: whitesmoke;
        border-radius: 2px;
        padding: 10px;
        text-decoration: none;
    }


        .shopping-cart .delete-shopping:hover {
            color: white;
            background-color: red;
            text-decoration: underline;
        }

    .shopping-cart .total-price-text {
        text-transform: uppercase;
        color: red;
        font-weight: bold;
    }

    .shopping-cart .total-price-digit {
        color: red;
        font-weight: bold;
    }

    .checkout-shopping {
        text-decoration: none;
        background-color: #40b0fe;
        padding: 10px;
        color: white;
        border: 1px solid black;
        border-radius: 2px;
        text-align: center;
    }

        .checkout-shopping:hover {
            text-decoration: none;
            box-shadow: 0 0 10px rgba(0,0,0,0.5); /* Параметры тени */
        }

    .continue-shopping {
        text-decoration: none;
        background-color: transparent;
        padding: 10px;
        color: black;
        border: 1px solid black;
        border-radius: 2px;
    }

        .continue-shopping:hover {
            text-decoration: none;
            background-color: green;
            padding: 10px;
            color: white;
        }

    .update-shopping {
        margin-right: 8px;
        background-color: whitesmoke;
        color: black;
        height: 50px;
        width: 160px;
        padding: 5px;
        border: 1px solid black;
        border-radius: 2px;
    }

        .update-shopping:hover {
            background-color: orange;
            color: white;
        }

    .deleteAll-shopping {
        background-color: whitesmoke;
        color: black;
        border: 1px solid black;
        border-radius: 2px;
    }


        .deleteAll-shopping:hover {
            background-color: red;
            color: white;
        }

    .line-breaks {
        white-space: pre-line;
    }
</style>
